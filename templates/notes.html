{% extends 'base.html' %}
{% block content%}

<!--HEADING-->

<h1 class="d-inline-block mr-2 mr-md-4 mr-lg-5">{{ language }} Notes </h1>
<a href="{{ url_for('addnote', language=language) }}">Add New <i class="fas fa-plus-circle"></i></a>




<!--TEXT SEARCH-->
<div class="row mt-2 mt-md-4 mb-2 pb-2 pb-md-3 line">

      <div class="col-auto">
            <p class="m-0">Filter by word <small><br class="d-none d-md-inline-block">(optional)</small></p>
      </div>
      <div class="col-auto p-0">

            <form class="d-inline-block d-flex align-items-baseline" method="POST" action="">
                  {{ form.hidden_tag() }}
                  <!--WHY: form instance. hidden_tag method for security - will come back to later-->
                  {{ form.tsearch(class="form-control width--tsearch height--tsearch d-inline-block b-0 ml-3 m-md-0") }}

                  {{ form.submit(class="btn button-style height--tsearch ml-3 mt-0 mb-0 mr-3 b-0")}}
                  <a href="{{ url_for('notes', language=language) }}"
                        class="btn button-style height--tsearch m-0">Clear</a>
            </form>

            <!--FLASH ERROR MESSAGE-->
            <div>
                        {% with messages = get_flashed_messages(category_filter=["search"]) %}
                        <!--WHERE: Flask Flash Documentation https://flask.palletsprojects.com/en/1.1.x/patterns/flashing/-->
                        {% if messages %}
                        {% for message in messages %}
                        <span class="message ml-3 m-md-0">{{ message }}</span>
                        {% endfor %}
                        {% endif %}
                        {% endwith %}
                    </div>
                    <!--WHY: Search messages displayed underneath submit button verses top of page to improve visibilty after submitting.-->
      </div>

</div>





{% for group_topic in group_topics %}
<!--WHAT: LEVEL 1 COLLAPSE - TOPIC-->

<div data-level="1">
      <button class="btn" type="button" data-blevel="1" data-bvalue="{{ group_topic._id}}">
            <i class="fas fa-angle-double-down"></i></button>
      <h2 class="d-inline-block">{{ group_topic._id}}</h2>
</div>

{% for note in notes %}
{% if note.topic == group_topic._id %}
<!--WHAT: LEVEL 2 COLLAPSE - NOTE NAME-->
<div data-level="2" data-2value="{{ group_topic._id}}">
      <button class="btn" type="button" data-blevel="2" data-bvalue="{{note._id}}"><i
                  class="fas fa-angle-down"></i></button>
      <h3 class="d-inline-block">{{ note.note_name }}</h3>
</div>

<div data-level="3" data-3value="{{note._id}}">
      <textarea readonly class="form-control" rows=4>{{note.content}}</textarea>

      <div class="d-flex justify-content-end">
            <a class="btn" href="{{url_for('editnote', language=language, noteid=note._id)}}">
                  <span class="pt-2 mr-1">Edit</span><i class="fas fa-edit"></i></a>

            <button class="btn ml-3" type="button" data-toggle="collapse" data-target="#delete{{note._id}}"
                  aria-expanded="false" aria-controls="collapsePoints">
                  <span class="pt-2 mr-1">Delete</span><i class="fas fa-trash-alt"></i>
            </button></div>
    


      <!--DELETE COLLAPSE-->
      <div class="collapse" id="delete{{note._id}}">
            <form class="d-flex justify-content-end"
                  action="{{url_for('deletenote', language=language, noteid=note._id)}}" method="POST">
                  <input type="submit" class="mt-3 btn button-style" value="I'm sure - delete this note">
            </form>
      </div>
        <!--WHY: Form wrapped in div to enable Bootstrap collapsing.-->
</div>


{% endif %}
{% endfor %}

{% endfor %}

{% endblock content%}