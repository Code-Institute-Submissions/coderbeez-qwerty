{% extends 'base.html' %}
{% block content%}
<h1>LINKS Python</h1>

{% for group_topic in group_topics %}
<!--WHAT: Level 1 Collapse - TOPIC-->
<h2> <button class="btn" type="button" data-toggle="collapse" data-target="#id{{ group_topic._id}}"
            aria-expanded="false" aria-controls="collapsePoints">
            <i class="fas fa-chevron-down"></i>
      </button>{{ group_topic._id}}</h2>

<!--WHY: Content want to collapse wrapped in div.-->
<div id="id{{ group_topic._id}}" class="collapse">

      {% for link in links %}
      {% if link.topic == group_topic._id %}

      {% if loop.previtem is undefined %}

      <h3 class="ml-3"><button class="btn" type="button" data-toggle="collapse"
                  data-target="#id{{ group_topic._id}}-{{link.link_type}}" aria-expanded="false"
                  aria-controls="collapsePoints">
                  <i class="fas fa-chevron-down"></i>
            </button>{{link.link_type}}</h3>
      {% elif loop.previtem.link_type != link.link_type %}

      <h3 class="ml-3"><button class="btn" type="button" data-toggle="collapse"
                  data-target="#id{{ group_topic._id}}-{{link.link_type}}" aria-expanded="false"
                  aria-controls="collapsePoints">
                  <i class="fas fa-chevron-down"></i>
            </button>{{link.link_type}}</h3>
      {% endif %}

      <!--WHAT: Level 2 Collapse - LINK TYPE-->
      <div id="id{{ group_topic._id}}-{{link.link_type}}" class="collapse">
            <p class="mb-1">
                  <button class="btn" type="button" data-toggle="collapse" data-target="#id{{link._id}}"
                        aria-expanded="false" aria-controls="collapsePoints">
                        <i class="fas fa-angle-down"></i>
                  </button>



                  <a href="{{ link.url }}" target="_blank">
                        <span class="star mr-1">{{(link.ratings|sum)//(link.ratings|count)}}*</span>
                        {{ link.link_name }}</a><br>
            </p>

            <!--WHAT: LEVEL 3 COLLAPSE - LINK ID-->
            <div class="collapse" id="id{{link._id}}">
                  <ul class="list-group p-0">
                        <li class="list-group-item">{{ link.description }}</li>
                        <li class="list-group-item">
                              <span class="mr-3">{{ link.ratings|count }} ratings to-date.  Add yours!</span>
                              <br class="d-block d-md-none">
                              <form class="d-inline-block mr-2" action="{{url_for('ratelink', linkid=link._id, rating=5)}}"
                                    method="POST">
                                    <input type="submit" class="btn button-style star m-0" value="5*">
                              </form>
                              <form class="d-inline-block mr-2" action="{{url_for('ratelink', linkid=link._id, rating=4)}}"
                                    method="POST">
                                    <input type="submit" class="btn button-style star m-0" value="4*">
                              </form>
                              <form class="d-inline-block mr-2" action="{{url_for('ratelink', linkid=link._id, rating=3)}}"
                                    method="POST">
                                    <input type="submit" class="btn button-style star m-0" value="3*">
                              </form>
                              <form class="d-inline-block mr-2" action="{{url_for('ratelink', linkid=link._id, rating=2)}}"
                                    method="POST">
                                    <input type="submit" class="btn button-style star m-0" value="2*">
                              </form>
                              <form class="d-inline-block" action="{{url_for('ratelink', linkid=link._id, rating=1)}}"
                                    method="POST">
                                    <input type="submit" class="btn button-style star m-0" value="1*">
                              </form>




                        </li>
                        <li class="list-group-item">
                              <span class="mr-2">Problem with link?</span>
                              <form class="d-inline-block" action="{{url_for('flaglink', linkid=link._id)}}"
                                    method="POST">
                                    <input type="submit" class="btn button-style m-0" value="Report">
                              </form>
                        </li>
                  </ul>


            </div>
      </div>

      {% endif %}
      {% endfor %}

</div>
<!--END TOPIC GROUP-->
{% endfor %}




{% endblock content %}