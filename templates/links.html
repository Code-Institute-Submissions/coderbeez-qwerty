{% extends 'base.html' %}
{% block content%}
<h1>LINKS {{ language }}</h1>

{% for group_topic in group_topics %}
<!--WHAT: Level 1 Collapse - TOPIC-->
<h2> <button class="btn" type="button" data-toggle="collapse" data-target="#id{{ group_topic._id}}"
            aria-expanded="false" aria-controls="collapsePoints">
            <i class="fas fa-chevron-down"></i>
      </button>{{ group_topic._id}}</h2>

<!--WHY: Content want to collapse wrapped in div.-->
<div id="id{{ group_topic._id}}" class="collapse">

      {% for link in links %}
      {% if link.topic == group_topic._id %}

      {% if loop.previtem is undefined %}

      <h3 class="ml-3"><button class="btn" type="button" data-toggle="collapse"
                  data-target="#id{{ group_topic._id}}-{{link.link_type}}" aria-expanded="false"
                  aria-controls="collapsePoints">
                  <i class="fas fa-chevron-down"></i>
            </button>{{link.link_type}}</h3>
      {% elif loop.previtem.link_type != link.link_type %}

      <h3 class="ml-3"><button class="btn" type="button" data-toggle="collapse"
                  data-target="#id{{ group_topic._id}}-{{link.link_type}}" aria-expanded="false"
                  aria-controls="collapsePoints">
                  <i class="fas fa-chevron-down"></i>
            </button>{{link.link_type}}</h3>
      {% endif %}

      <!--WHAT: Level 2 Collapse - LINK TYPE-->
      <div id="id{{ group_topic._id}}-{{link.link_type}}" class="collapse">
            <p class="mb-1">
                  <button class="btn" type="button" data-toggle="collapse" data-target="#id{{link._id}}"
                        aria-expanded="false" aria-controls="collapsePoints">
                        <i class="fas fa-info-circle"></i>
                  </button>
                  <a href="{{ link.url }}" target="_blank">
                        {{ link.link_name }}
                        <span class="ml-1">{{(link.ratings|sum)//(link.ratings|count)}}
                              <i class="fas fa-star"></i></span></a><br>
            </p>

            <!--WHAT: LEVEL 3 COLLAPSE - LINK ID-->
            <div class="collapse" id="id{{link._id}}">
                  <ul class="list-group p-0">
                        <li class="list-group-item">{{ link.description }}<br><small>{{ link.ratings|count }} ratings
                                    to-date.</small></li>

                        <!--STAR RATING & REPORT PROBLEM-->
                        <li class="list-group-item">
                              <span class="">Rate</span>
                              <form class="d-inline-block mr-2"
                                    action="{{url_for('ratelink', linkid=link._id, rating=5)}}" method="POST">
                                    <button type="submit" class="button-style--i p-0">
                                          <i class="far fa-star"></i></button>
                              </form>
                              <form class="d-inline-block mr-2"
                                    action="{{url_for('ratelink', linkid=link._id, rating=4)}}" method="POST">
                                    <button type="submit" class="button-style--i p-0">
                                          <i class="far fa-star"></i></button>
                              </form>
                              <form class="d-inline-block mr-2"
                                    action="{{url_for('ratelink', linkid=link._id, rating=3)}}" method="POST">
                                    <button type="submit" class="button-style--i p-0">
                                          <i class="far fa-star"></i></button>
                              </form>
                              <form class="d-inline-block mr-2"
                                    action="{{url_for('ratelink', linkid=link._id, rating=2)}}" method="POST">
                                    <button type="submit" class="button-style--i p-0">
                                          <i class="far fa-star"></i></button>
                              </form>
                              <form class="d-inline-block" action="{{url_for('ratelink', linkid=link._id, rating=1)}}"
                                    method="POST">
                                    <button type="submit" class="button-style--i p-0">
                                          <i class="far fa-star"></i></button>
                              </form>
                              <br class="d-block d-md-none">

                              <span class="ml-md-5">Report problem</span>
                              <form class="d-inline-block" action="{{url_for('flaglink', linkid=link._id)}}"
                                    method="POST">
                                    <button type="submit" class="button-style--i p-0">
                                          <i class="fas fa-tools"></i></button>
                              </form>
                  </ul>


            </div>
      </div>

      {% endif %}
      {% endfor %}

</div>
<!--END TOPIC GROUP-->
{% endfor %}




{% endblock content %}